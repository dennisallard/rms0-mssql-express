<!--
Plan:
    revamp to use async fetch per https://rapidapi.com/guides/fetch-api-async-await
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
</head>

<body>
  api input:
  <!--  <input type="text" id="inputarg"> -->
  <textarea id="inputarg" name="graphql parameter" rows="10" cols="80" style="display: block" value=""></textarea>
  <br>
  api output:
  <textarea id="output" name="graphql response" rows="15" cols="80" style="display: block" value=""></textarea>
  <br>
  <button onclick="processInput();">process input</button>

<script>
function processInput() {
    console.log('DEBUG: processInput() ...')
    var inputarg = $('#inputarg').val();
    inputarg = inputarg.trim()
    const method = inputarg.startsWith('mutation') ? 'POST' : 'GET'
    console.log('DEBUG: method = ' + method)
    var url = "http://localhost:3001/graphql?query=" + inputarg
    var result = "nada";
    console.log('DEBUG: JUST BEFORE fetch url = ' + url)
    fetch(url, {method: method, headers: {"referrerPolicy": "unsafe-url", "mode": "cors"}})
        .then(response => response.json())
        .then(data => {
          result = data
          console.log("result = " + JSON.stringify(result))
          })
        .then(() => {
          if (result.errors) {
            console.log('ERROR: fetch failed ' + JSON.stringify(result.errors, undefined, 2))
            $('#output').val(JSON.stringify(result.errors, undefined, 2))
          } else {
            $('#output').val(JSON.stringify(result.data, undefined, 2))
          }
        })
        .catch(error => {
          console.log('ERROR: fetch failed ' + error)
          $('#output').val(error)
        })
}
</script>
</body>
</html>
    
